# –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π AI –ü—Ä–æ–∫—Å–∏ –Ω–∞ Cloudflare

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –≤—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—É—é –∏ –±–µ–∑–æ–ø–∞—Å–Ω—É—é –ø—Ä–æ–∫—Å–∏-—Å–∏—Å—Ç–µ–º—É –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ AI API (OpenAI, Google Gemini, Anthropic –∏ –¥—Ä.). –°–∏—Å—Ç–µ–º–∞ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–∞ –±–∞–∑–µ Cloudflare Workers –¥–ª—è –ø–æ–≥—Ä–∞–Ω–∏—á–Ω—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π –∏ Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ (Nginx + Cloudflare Tunnel) –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞—â–∏—â–µ–Ω–Ω–æ–≥–æ –±—ç–∫–µ–Ω–¥–∞.

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–ó–∞–ø—Ä–æ—Å –ø—Ä–æ—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ —ç—Ç–∞–ø–æ–≤, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—â–∏—Ö –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ—Å—Ç—å –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:

```
–ö–ª–∏–µ–Ω—Ç ‚û°Ô∏è Cloudflare Worker ‚û°Ô∏è Cloudflare Tunnel ‚û°Ô∏è Nginx (Docker) ‚û°Ô∏è –¶–µ–ª–µ–≤–æ–π AI API
```

1. **Cloudflare Worker**: –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞. –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã, –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ü–µ–ª–µ–≤–æ–π API, –¥–æ–±–∞–≤–ª—è–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∏ –Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –≤ —Ç—É–Ω–Ω–µ–ª—å.
2. **Cloudflare Tunnel**: –°–æ–∑–¥–∞–µ—Ç –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π –∏ —Å—Ç–∞–±–∏–ª—å–Ω—ã–π —Ç—É–Ω–Ω–µ–ª—å –æ—Ç —Å–µ—Ç–∏ Cloudflare –¥–æ –≤–∞—à–µ–≥–æ Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞, –∏–∑–±–∞–≤–ª—è—è –æ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∏–º–µ—Ç—å —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π IP –∏ –æ—Ç–∫—Ä—ã–≤–∞—Ç—å –ø–æ—Ä—Ç—ã.
3. **Nginx**: –†–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –ø—Ä–æ–∫—Å–∏. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–∞ –æ—Ç Worker'–∞ –∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –µ–≥–æ –Ω–∞ –∫–æ–Ω–µ—á–Ω—ã–π API (–Ω–∞–ø—Ä–∏–º–µ—Ä, `api.openai.com`).

## ‚ú® –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **üîÑ –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ—Å—Ç—å**: –ü—Ä–æ–∫—Å–∏—Ä—É–π—Ç–µ –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ –ª—é–±–æ–π API, –ø—Ä–æ—Å—Ç–æ —É–∫–∞–∑–∞–≤ —Ü–µ–ª–µ–≤–æ–π —Ö–æ—Å—Ç –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ `X-Target-Host`.
- **‚öôÔ∏è –†–µ–∂–∏–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é**: –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Ö–æ—Å—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –º–æ–≥—É—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –∫–∞—Å—Ç–æ–º–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –Ω–æ–¥—ã n8n).
- **üîó –ö–æ–Ω–Ω–µ–∫—Ç–æ—Ä OpenAI-to-Gemini**: –í–∫–ª—é—á–∞–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–π Worker, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞ –ª–µ—Ç—É –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ OpenAI API –≤ —Ñ–æ—Ä–º–∞—Ç Google Gemini API, –ø–æ–∑–≤–æ–ª—è—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Gemini –≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ö, –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –¥–ª—è OpenAI.
- **üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**:
  - –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–∞ —É—Ä–æ–≤–Ω–µ Worker'–∞ –ø–æ `X-Master-Key`.
  - –ó–∞—â–∏—â–µ–Ω–Ω—ã–π –∫–∞–Ω–∞–ª –º–µ–∂–¥—É Worker'–æ–º –∏ Nginx —Å –ø–æ–º–æ—â—å—é –æ–±—â–µ–≥–æ —Å–µ–∫—Ä–µ—Ç–∞ (`NGINX_INTERNAL_SECRET`).
  - –í–∞—à —Å–µ—Ä–≤–µ—Ä –æ—Å—Ç–∞–µ—Ç—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –æ—Ç –ø—É–±–ª–∏—á–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞.
- **üöÄ –ü—Ä–æ—Å—Ç–æ—Ç–∞ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è**: –í—Å—è –±—ç–∫–µ–Ω–¥-–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π `docker-compose up -d`.

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
.
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ .env
‚îî‚îÄ‚îÄ nginx/
    ‚îú‚îÄ‚îÄ Dockerfile
    ‚îú‚îÄ‚îÄ entrypoint.sh
    ‚îî‚îÄ‚îÄ nginx.conf.template
```

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### –®–∞–≥ 1: –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- –ê–∫–∫–∞—É–Ω—Ç [Cloudflare](https://www.cloudflare.com/)
- –°–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º–µ–Ω, –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–π –≤ Cloudflare
- –°–µ—Ä–≤–µ—Ä (VDS/VPS) —Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–º–∏ [Docker](https://docs.docker.com/engine/install/) –∏ [Docker Compose](https://docs.docker.com/compose/install/)

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Cloudflare Tunnel

1. –í –¥–∞—à–±–æ—Ä–¥–µ Cloudflare –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ `Zero Trust`
2. –û—Ç–∫—Ä–æ–π—Ç–µ `Access` ‚Üí `Tunnels`
3. –ù–∞–∂–º–∏—Ç–µ `Create a tunnel`, –≤—ã–±–µ—Ä–∏—Ç–µ `Cloudflared` –∏ –¥–∞–π—Ç–µ –µ–º—É –∏–º—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, `ai-proxy-tunnel`)
4. –ù–∞ —Å–ª–µ–¥—É—é—â–µ–º —à–∞–≥–µ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Ç—É–Ω–Ω–µ–ª—è. **–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –µ–≥–æ**. –û–Ω –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –¥–ª—è `CLOUDFLARED_TOKEN`
5. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ `Public Hostname` –¥–ª—è —Ç—É–Ω–Ω–µ–ª—è:
   - **Subdomain:** `proxy` (–∏–ª–∏ –ª—é–±–æ–µ –¥—Ä—É–≥–æ–µ –∏–º—è)
   - **Domain:** `your-domain.com`
   - **Service ‚Üí Type:** `HTTP`
   - **Service ‚Üí URL:** `nginx:8080` (—ç—Ç–æ –∏–º—è Docker-—Å–µ—Ä–≤–∏—Å–∞ –∏ –µ–≥–æ –ø–æ—Ä—Ç)
6. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ç—É–Ω–Ω–µ–ª—å

### –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±—ç–∫–µ–Ω–¥–∞

1. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª—ã –∏ –ø–∞–ø–∫–∏ —Å–æ–≥–ª–∞—Å–Ω–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ, —É–∫–∞–∑–∞–Ω–Ω–æ–π –≤—ã—à–µ
2. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –µ–≥–æ:

```env
# .env

# –¢–æ–∫–µ–Ω –∏–∑ –¥–∞—à–±–æ—Ä–¥–∞ Cloudflare Tunnels
CLOUDFLARED_TOKEN=–í–ê–®_–°–ö–û–ü–ò–†–û–í–ê–ù–ù–´–ô_–¢–û–ö–ï–ù

# –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –¥–ª–∏–Ω–Ω—ã–π –∏ —Å–ª–æ–∂–Ω—ã–π —Å–µ–∫—Ä–µ—Ç –¥–ª—è —Å–≤—è–∑–∏ Worker -> Nginx
# –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å 'openssl rand -hex 32'
NGINX_INTERNAL_SECRET=–í–ê–®_–°–õ–û–ñ–ù–´–ô_–°–ï–ö–†–ï–¢
```

3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã:
```bash
docker-compose up -d
```

### –®–∞–≥ 4: –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ Cloudflare Workers

–í–∞–º –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –¥–≤–∞ Worker'–∞ –∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤ –Ω–∏—Ö —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥.

#### 1. –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –ø—Ä–æ–∫—Å–∏ (`proxy.your-domain.com`)

1. –°–æ–∑–¥–∞–π—Ç–µ Worker –≤ –¥–∞—à–±–æ—Ä–¥–µ Cloudflare
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ `Settings` ‚Üí `Variables` –∏ –¥–æ–±–∞–≤—å—Ç–µ **Environment Variables**:
   - `GCP_PROXY_URL` (Plain Text): `https://proxy.your-domain.com` (URL –≤–∞—à–µ–≥–æ —Ç—É–Ω–Ω–µ–ª—è)
   - `DEFAULT_UPSTREAM_HOST` (Plain Text): `api.openai.com` (–•–æ—Å—Ç –¥–ª—è n8n)
   - `MASTER_API_KEY` (Secret): –í–∞—à –≥–ª–∞–≤–Ω—ã–π –∫–ª—é—á –¥–æ—Å—Ç—É–ø–∞ –∫ –ø—Ä–æ–∫—Å–∏
   - `NGINX_INTERNAL_SECRET` (Secret): –¢–æ—Ç –∂–µ —Å–µ–∫—Ä–µ—Ç, —á—Ç–æ –∏ –≤ `.env` —Ñ–∞–π–ª–µ
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤–æ –≤–∫–ª–∞–¥–∫—É `Triggers` –∏ –ø—Ä–∏–≤—è–∂–∏—Ç–µ Worker –∫ –≤–∞—à–µ–º—É –º–∞—Ä—à—Ä—É—Ç—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, `proxy.your-domain.com/*`)

#### 2. –ö–æ–Ω–Ω–µ–∫—Ç–æ—Ä OpenAI-to-Gemini (`gemini.your-domain.com`)

1. –°–æ–∑–¥–∞–π—Ç–µ –≤—Ç–æ—Ä–æ–π Worker
2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –µ–≥–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
   - `GCP_PROXY_URL` (Plain Text): `https://proxy.your-domain.com`
   - `MASTER_API_KEY` (Secret): –í–∞—à –≥–ª–∞–≤–Ω—ã–π –∫–ª—é—á –¥–æ—Å—Ç—É–ø–∞
   - `NGINX_INTERNAL_SECRET` (Secret): –¢–æ—Ç –∂–µ —Å–µ–∫—Ä–µ—Ç, —á—Ç–æ –∏ –≤ `.env`
   - `GOOGLE_API_KEY` (Secret): –í–∞—à API-–∫–ª—é—á –æ—Ç Google AI Studio
3. –ü—Ä–∏–≤—è–∂–∏—Ç–µ –µ–≥–æ –∫ –¥—Ä—É–≥–æ–º—É –º–∞—Ä—à—Ä—É—Ç—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, `gemini.your-domain.com/*`)

## üíª –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### 1. –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –ø—Ä–æ–∫—Å–∏

**–ó–∞–ø—Ä–æ—Å –Ω–∞ —Ö–æ—Å—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (OpenAI):**
```bash
curl https://proxy.your-domain.com/v1/chat/completions \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $OPENAI_API_KEY" \
  -H "X-Master-Key: $MASTER_API_KEY" \
  -d '{
    "model": "gpt-4o",
    "messages": [{"role":"user", "content":"Hello"}]
  }'
```

**–ó–∞–ø—Ä–æ—Å –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π —Ö–æ—Å—Ç (Anthropic):**
```bash
curl https://proxy.your-domain.com/v1/messages \
  -H "Content-Type: application/json" \
  -H "x-api-key: $ANTHROPIC_API_KEY" \
  -H "X-Master-Key: $MASTER_API_KEY" \
  -H "X-Target-Host: api.anthropic.com" \
  -H "anthropic-version: 2023-06-01" \
  -d '{
    "model": "claude-3-opus-20240229",
    "messages": [{"role":"user", "content":"Hello"}],
    "max_tokens": 100
  }'
```

### 2. Gemini-–∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç OpenAI, –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä –≤—Å–µ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç —Å–∞–º.

**–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –º–æ–¥–µ–ª–µ–π Gemini:**
```bash
curl https://gemini.your-domain.com/v1/models \
  -H "X-Master-Key: $MASTER_API_KEY"
```

**–ó–∞–ø—Ä–æ—Å –∫ —á–∞—Ç—É Gemini:**
```bash
curl https://gemini.your-domain.com/v1/chat/completions \
  -H "Content-Type: application/json" \
  -H "X-Master-Key: $MASTER_API_KEY" \
  -d '{
    "model": "gemini-1.5-flash-latest",
    "messages": [
      {"role": "user", "content": "–†–∞—Å—Å–∫–∞–∂–∏ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π —Ñ–∞–∫—Ç –æ –∫–æ—Å–º–æ—Å–µ."}
    ]
  }'
```

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ–¥ –ª–∏—Ü–µ–Ω–∑–∏–µ–π MIT. –°–º. —Ñ–∞–π–ª [LICENSE](LICENSE) –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.

## ü§ù –í–∫–ª–∞–¥ –≤ –ø—Ä–æ–µ–∫—Ç

–ú—ã –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É–µ–º –≤–∫–ª–∞–¥ –≤ —Ä–∞–∑–≤–∏—Ç–∏–µ –ø—Ä–æ–µ–∫—Ç–∞! –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–æ–∑–¥–∞–π—Ç–µ issue –∏–ª–∏ pull request –¥–ª—è –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π.

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ —É –≤–∞—Å –≤–æ–∑–Ω–∏–∫–ª–∏ –≤–æ–ø—Ä–æ—Å—ã –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã, —Å–æ–∑–¥–∞–π—Ç–µ issue –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –∏–ª–∏ —Å–≤—è–∂–∏—Ç–µ—Å—å —Å –Ω–∞–º–∏.